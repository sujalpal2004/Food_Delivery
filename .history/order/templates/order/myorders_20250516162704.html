{% extends 'base/base.html' %}
{% block title %}My Orders{% endblock title %}

{% block extrahead %}
<style>
  /* Modern Orders Page Styling */
  :root {
    --gradient-primary: linear-gradient(135deg, #6e8efb, #a777e3);
    --gradient-secondary: linear-gradient(135deg, #11998e, #38ef7d);
    --gradient-warning: linear-gradient(135deg, #f6d365, #fda085);
    --gradient-danger: linear-gradient(135deg, #ff9a9e, #fad0c4);
    --gradient-info: linear-gradient(135deg, #0acffe, #495aff);
    --box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    --border-radius: 12px;
    --transition-speed: 0.3s;
  }

  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #f8f9fa;
    color: #333;
  }

  .orders-container {
    padding: 30px;
    max-width: 1200px;
    margin: 0 auto;
  }

  .page-title {
    text-align: center;
    margin-bottom: 30px;
    position: relative;
    padding-bottom: 15px;
    color: #333;
    font-weight: 700;
  }

  .page-title::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 100px;
    height: 4px;
    background: var(--gradient-primary);
    border-radius: 2px;
  }

  /* Table styling */
  .orders-table {
    border-radius: var(--border-radius);
    overflow: hidden;
    box-shadow: var(--box-shadow);
    margin-bottom: 40px;
    animation: fadeIn 0.8s ease-out;
  }

  .table {
    margin-bottom: 0;
  }

  .table thead {
    background: var(--gradient-primary);
    color: white;
  }

  .table thead th {
    border: none;
    padding: 15px;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 14px;
    letter-spacing: 1px;
  }

  .table tbody tr {
    transition: all var(--transition-speed);
    animation: fadeIn 0.5s ease-out forwards;
    opacity: 0;
  }

  .table tbody tr:nth-child(odd) {
    background-color: rgba(0, 0, 0, 0.02);
  }

  .table tbody tr:hover {
    background-color: rgba(110, 142, 251, 0.1);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
  }

  .table td, .table th {
    padding: 15px;
    vertical-align: middle;
  }

  /* Generate animation delays for table rows */
  .table tbody tr:nth-child(1) { animation-delay: 0.1s; }
  .table tbody tr:nth-child(2) { animation-delay: 0.2s; }
  .table tbody tr:nth-child(3) { animation-delay: 0.3s; }
  .table tbody tr:nth-child(4) { animation-delay: 0.4s; }
  .table tbody tr:nth-child(5) { animation-delay: 0.5s; }
  .table tbody tr:nth-child(6) { animation-delay: 0.6s; }
  .table tbody tr:nth-child(7) { animation-delay: 0.7s; }
  .table tbody tr:nth-child(8) { animation-delay: 0.8s; }
  .table tbody tr:nth-child(9) { animation-delay: 0.9s; }
  .table tbody tr:nth-child(10) { animation-delay: 1.0s; }

  /* Order ID styling */
  .order-id {
    font-weight: 700;
    color: #6e8efb;
  }

  /* Progress bar styling */
  .progress {
    height: 10px;
    margin-top: 8px;
    border-radius: 5px;
    overflow: hidden;
    background-color: #f0f0f0;
    box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
  }

  .progress-bar {
    transition: width 1s ease;
    background-size: 30px 30px;
    background-image: linear-gradient(
      45deg,
      rgba(255, 255, 255, 0.15) 25%,
      transparent 25%,
      transparent 50%,
      rgba(255, 255, 255, 0.15) 50%,
      rgba(255, 255, 255, 0.15) 75%,
      transparent 75%,
      transparent
    );
  }

  .progress-bar-animated {
    animation: progress-bar-stripes 1s linear infinite;
  }

  @keyframes progress-bar-stripes {
    from { background-position: 30px 0; }
    to { background-position: 0 0; }
  }

  /* Status badges */
  .status-badge {
    display: inline-block;
    padding: 5px 10px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 5px;
    color: white;
  }

  .status-pending {
    background: linear-gradient(135deg, #757F9A, #D7DDE8);
  }

  .status-accepted {
    background: var(--gradient-info);
  }

  .status-cooking {
    background: linear-gradient(135deg, #667eea, #764ba2);
  }

  .status-packed {
    background: var(--gradient-warning);
  }

  .status-completed {
    background: var(--gradient-secondary);
  }

  /* Button styling */
  .btn-view-details {
    background: var(--gradient-primary);
    border: none;
    color: white;
    padding: 8px 15px;
    border-radius: 20px;
    font-weight: 600;
    transition: all var(--transition-speed);
    box-shadow: 0 4px 10px rgba(110, 142, 251, 0.3);
  }

  .btn-view-details:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(110, 142, 251, 0.4);
  }

  .btn-view-details:active {
    transform: translateY(0);
  }

  /* Modal styling */
  .modal-content {
    border-radius: 15px;
    border: none;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
    overflow: hidden;
  }

  .modal-header {
    background: var(--gradient-primary);
    color: white;
    border-bottom: none;
    padding: 20px 25px;
  }

  .modal-title {
    font-weight: 600;
  }

  .modal-body {
    padding: 25px;
  }

  .modal-footer {
    border-top: none;
    padding: 15px 25px 25px;
  }

  .btn-close {
    color: white;
    opacity: 1;
    filter: brightness(0) invert(1);
  }

  .order-detail-section {
    margin-bottom: 20px;
  }

  .order-detail-title {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 15px;
    position: relative;
    padding-left: 15px;
  }

  .order-detail-title::before {
    content: "";
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    width: 4px;
    background: var(--gradient-primary);
    border-radius: 2px;
  }

  .order-info {
    background-color: #f8f9fa;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 20px;
  }

  .order-info p {
    margin-bottom: 8px;
  }

  .fw-bold {
    color: #555;
  }

  /* Modal table styling */
  .modal-table {
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
  }

  .modal-table thead {
    background: linear-gradient(135deg, #8E2DE2, #4A00E0);
    color: white;
  }

  .modal-table thead th {
    font-weight: 600;
    text-transform: uppercase;
    font-size: 12px;
    letter-spacing: 1px;
    padding: 12px;
  }

  /* Empty orders message */
  .empty-orders {
    text-align: center;
    padding: 50px 20px;
    background: white;
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    animation: fadeIn 0.8s ease-out;
  }

  .empty-orders h1 {
    font-size: 24px;
    color: #6e8efb;
    margin-bottom: 20px;
  }

  .empty-orders-icon {
    font-size: 60px;
    margin-bottom: 20px;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  /* Animations */
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes pulse {
    0% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.05);
    }
    100% {
      transform: scale(1);
    }
  }

  /* Modal animation */
  .modal.fade .modal-dialog {
    transform: scale(0.8);
    opacity: 0;
    transition: all 0.3s ease-in-out;
  }

  .modal.show .modal-dialog {
    transform: scale(1);
    opacity: 1;
  }

  /* Responsive adjustments */
  @media (max-width: 992px) {
    .orders-container {
      padding: 20px 15px;
    }
    
    .table thead th {
      font-size: 12px;
      padding: 12px 8px;
    }
    
    .table td, .table th {
      padding: 12px 8px;
    }
    
    .status-badge {
      font-size: 10px;
      padding: 4px 8px;
    }
  }

  @media (max-width: 768px) {
    .orders-table {
      overflow-x: auto;
    }
    
    .table {
      min-width: 800px;
    }
  }
</style>
{% endblock extrahead %}

{% block maincontent %}
<div class="orders-container">
  <h1 class="page-title">My Orders</h1>

  {% if orders %}
  <div class="orders-table">
    <table class="table table-striped text-center table-bordered">
      <thead>
        <tr>
          <th scope="col">Order Id</th>
          <th scope="col">Order Date</th>
          <th scope="col">Amount Paid</th>
          <th scope="col">Payment Mode</th>
          <th scope="col">Order Status</th>
          <th scope="col">Order Details</th>
        </tr>
      </thead>
      <tbody class="table-group-divider">
        {% for order in orders %}
        <tr>
          <th scope="row" class="order-id">#{{order.id}}</th>
          <td>{{order.order_datetime}}</td>
          <td>{{order.total_amount}}</td>
          <td>{{order.payment_mode}}</td>
          <td>
            <div class="status-badge 
              {% if order.status == 'Pending' %}status-pending
              {% elif order.status == 'Accepted' %}status-accepted
              {% elif order.status == 'Cooking' %}status-cooking
              {% elif order.status == 'Packed' %}status-packed
              {% elif order.status == 'Completed' %}status-completed{% endif %}">
              {{order.status}}
            </div>
            <div class="progress">
              {% if order.status == "Pending" %}
                <div class="progress-bar bg-secondary progress-bar-striped progress-bar-animated" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
              {% elif order.status == "Accepted" %}
                <div class="progress-bar bg-info progress-bar-striped" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
              {% elif order.status == "Cooking" %}
                <div class="progress-bar bg-primary progress-bar-striped" role="progressbar" style="width: 50%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
              {% elif order.status == "Packed" %}
                <div class="progress-bar bg-warning progress-bar-striped" role="progressbar" style="width: 75%" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>	
              {% elif order.status == "Completed" %}
                <div class="progress-bar bg-success" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
              {% endif %}
            </div>
          </td>
          <td>
            <button type="button" class="btn btn-view-details" data-bs-toggle="modal" data-bs-target="#orderNumber{{order.id}}">
              View details
            </button>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% for order in orders %}
  <div class="modal fade" id="orderNumber{{order.id}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">Order #{{order.id}} Details</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="order-info">
            <p class="m-0"><span class="fw-bold">Ordered On:</span> {{order.order_datetime}}</p>
            <p class="m-0"><span class="fw-bold">Amount Paid:</span> {{order.total_amount}}</p>
            <p class="m-0"><span class="fw-bold">Transaction Id:</span> {{order.transaction_id}}</p>
            <p class="m-0"><span class="fw-bold">Payment Mode:</span> {{order.payment_mode}}</p>
            <p class="m-0"><span class="fw-bold">Payment Gateway:</span> {{order.payment_gateway}}</p>
            <p class="m-0"><span class="fw-bold">Order Status:</span> 
              <span class="status-badge 
                {% if order.status == 'Pending' %}status-pending
                {% elif order.status == 'Accepted' %}status-accepted
                {% elif order.status == 'Cooking' %}status-cooking
                {% elif order.status == 'Packed' %}status-packed
                {% elif order.status == 'Completed' %}status-completed{% endif %}">
                {{order.status}}
              </span>
            </p>
          </div>
          
          <div class="order-detail-section">
            <h3 class="order-detail-title">Your Order Items</h3>
            <div class="modal-table">
              <table class="table table-striped text-center table-bordered">
                <thead>
                  <tr>
                    <th scope="col">Food</th>
                    <th scope="col">Price</th>
                    <th scope="col">Quantity</th>
                    <th scope="col">Amount</th>
                  </tr>
                </thead>
                <tbody class="table-group-divider">
                  {% for item in order_items %}
                    {% if item.order.id == order.id %}
                      <tr>
                        <th scope="row">{{item.name}}</th>
                        <td>{{item.price}}</td>
                        <td>{{item.quantity}}</td>
                        <td>{{item.item_total}}</td>
                      </tr>
                    {% endif %}
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
  
  {% else %}
  <div class="empty-orders">
    <div class="empty-orders-icon">📋</div>
    <h1>You Haven't Placed Any Orders Yet</h1>
    <p>Your order history will appear here once you place an order.</p>
  </div>
  {% endif %}
</div>
{% endblock maincontent %}